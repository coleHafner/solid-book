<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>File Upload | The Big Incomplete Book of Dev</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.0.1">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <link rel="next" href="../../general/profiling/index.html" />
    
    
    <link rel="prev" href="../../general/devops/deployment/index.html" />
    

        
    </head>
    <body>
        
        
    <link rel="stylesheet" href="../../gitbook/style.css">
    
    

        
    <div class="book" data-level="1.3" data-basepath="../.." data-revision="Wed Apr 15 2015 23:52:33 GMT-0700 (PDT)">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        

        

        
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../../index.html">
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1" >
            
            <span><b>1.</b> General</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1" >
            
            <span><b>1.1.</b> Code Quality</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="general/architecture/index.html">
            
                
                    <a href="../../general/architecture/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.1.</b>
                        
                        Architecture
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
            <span><b>1.2.</b> DevOps</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="general/devops/deployment/index.html">
            
                
                    <a href="../../general/devops/deployment/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.2.1.</b>
                        
                        Deployment
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter active" data-level="1.3" data-path="general/file-upload/index.html">
            
                
                    <a href="../../general/file-upload/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.3.</b>
                        
                        File Upload
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="general/profiling/index.html">
            
                
                    <a href="../../general/profiling/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.4.</b>
                        
                        Profiling
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="general/version-control/index.html">
            
                
                    <a href="../../general/version-control/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.5.</b>
                        
                        Version Control
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
            <span><b>1.6.</b> Issue tracking</span>
            
            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="general/security/index.html">
            
                
                    <a href="../../general/security/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.7.</b>
                        
                        Security
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2" >
            
            <span><b>2.</b> Detail</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1" data-path="detail/elasticsearch/index.html">
            
                
                    <a href="../../detail/elasticsearch/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                        Elasticsearch
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="detail/fastcgi/index.html">
            
                
                    <a href="../../detail/fastcgi/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.2.</b>
                        
                        FastCgi
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="detail/form/index.html">
            
                
                    <a href="../../detail/form/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.3.</b>
                        
                        Form
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.4" >
            
            <span><b>2.4.</b> Git</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.4.1" data-path="detail/git/gitflow/index.html">
            
                
                    <a href="../../detail/git/gitflow/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.1.</b>
                        
                        Gitflow
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.4.2" data-path="detail/git/hooks/index.html">
            
                
                    <a href="../../detail/git/hooks/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.4.2.</b>
                        
                        Hooks
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.5" >
            
            <span><b>2.5.</b> Mysql</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="detail/mysql/profiling/index.html">
            
                
                    <a href="../../detail/mysql/profiling/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.1.</b>
                        
                        Profiling
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="detail/mysql/users/index.html">
            
                
                    <a href="../../detail/mysql/users/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.5.2.</b>
                        
                        Users
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" >
            
            <span><b>2.6.</b> Nginx</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.6.1" data-path="detail/nginx/config/index.html">
            
                
                    <a href="../../detail/nginx/config/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.1.</b>
                        
                        Config
                    </a>
                
            
            
        </li>
    
        <li class="chapter " data-level="2.6.2" data-path="detail/nginx/fastcgi-cache/index.html">
            
                
                    <a href="../../detail/nginx/fastcgi-cache/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.6.2.</b>
                        
                        Fastcgi cache
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.7" >
            
            <span><b>2.7.</b> PHP</span>
            
            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.7.1" data-path="detail/php/xdebug/index.html">
            
                
                    <a href="../../detail/php/xdebug/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.7.1.</b>
                        
                        Xdebug &amp; Vagrant
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="detail/shell/index.html">
            
                
                    <a href="../../detail/shell/index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.8.</b>
                        
                        Shell Commands
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                Published with GitBook
            </a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../../" >The Big Incomplete Book of Dev</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="file-upload">File Upload</h1>
<h2 id="files-api">Files api</h2>
<p>Sending files via html/js can be done using the file api.</p>
<h3 id="javascript-example">JavaScript example</h3>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">&quot;file&quot;</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">&quot;it&quot;</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">&quot;files&quot;</span> <span class="hljs-attribute">multiple</span>=<span class="hljs-value">&quot;multiple&quot;</span> <span class="hljs-attribute">accept</span>=<span class="hljs-value">&quot;image/*&quot;</span> /&gt;</span>
</code></pre>
<pre><code class="lang-javascript">$.each($(<span class="hljs-string">&apos;input#it&apos;</span>).files, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(file)</span> </span>{
    postNewAsset(file)
        .progress(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(progress)</span> </span>{
            <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Progress &apos;</span> + progress);
        })
        .then(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
            alert(<span class="hljs-string">&apos;File uploaded!!!!&apos;</span>);
        });
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">postNewAsset</span> <span class="hljs-params">(file)</span> </span>{
    <span class="hljs-keyword">var</span> form_data = <span class="hljs-keyword">new</span> FormData(),
        $deferred = <span class="hljs-keyword">new</span> $.Deferred(),
        request;

    form_data.append(<span class="hljs-string">&apos;file&apos;</span>, file);

    request = <span class="hljs-keyword">new</span> XMLHttpRequest();

    request.upload.addEventListener(<span class="hljs-string">&apos;progress&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
        $deferred.notify((e.loaded / e.total) * <span class="hljs-number">100</span> + <span class="hljs-string">&apos;%&apos;</span>);
    }, <span class="hljs-literal">false</span>);

    request.open(<span class="hljs-string">&apos;POST&apos;</span>, <span class="hljs-string">&apos;http://example.com/upload&apos;</span>);

    request.setRequestHeader(<span class="hljs-string">&apos;Accept&apos;</span>, <span class="hljs-string">&apos;*/*&apos;</span>);

    request.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">if</span> (request.readyState !== <span class="hljs-number">4</span>) {
            <span class="hljs-keyword">return</span>;
        }
        <span class="hljs-keyword">if</span> ([<span class="hljs-number">200</span>, <span class="hljs-number">304</span>].indexOf(request.status) === -<span class="hljs-number">1</span>) {
            $deferred.reject(request.status);
        } <span class="hljs-keyword">else</span> {
            $deferred.resolve(<span class="hljs-built_in">JSON</span>.parse(request.response).message);
        }
    };

    request.send(form_data);

    <span class="hljs-keyword">return</span> $deferred.promise();
}
</code></pre>
<h2 id="multipart">Multipart</h2>
<p>Multipart form data is used to send form data. It can be used to send files.</p>
<h3 id="sending-multipart-data-to-the-server">Sending multipart data to the server</h3>
<ul>
<li>Data must be sent with a <code>Content-Type: multipart/form-data, boundary=--MY_UNIQUE_BOUNDARY--</code> header</li>
<li>The boundary is used to separate fields in the form. Example:</li>
</ul>
<pre><code class="lang-text">----MY_UNIQUE_BOUNDARY--
Content-Disposition: form-data; name=&quot;field1&quot;

field value here
----MY_UNIQUE_BOUNDARY--
Content-Disposition: attachment; name=&quot;file1&quot;; filename=&quot;my_file.jpg&quot;
Content-Type: image/jpeg
Content-Transfer-Encoding: base64

874fbiu45fguh4uyb45b8uyb45uyb43fyutgrvub4yutgvbybrvuyuyfbuierhg4eiguqiubiuw4bgiu4b8b45g4g...
----MY_UNIQUE_BOUNDARY----
</code></pre>
<ul>
<li>Notes<ul>
<li>boundaries in the post body must be prefixed with two hyphens (<code>--</code>)</li>
<li>the final boundary must have another two hyphens appended to it</li>
<li>lines must be terminated with a carriage-return followed by a line-break (<code>\r\n</code>)</li>
<li>Content-Encoding may be <code>base64</code> or <code>binary</code> (other encodings might be allowed as well)</li>
</ul>
</li>
</ul>
<h4 id="c-example">C# example</h4>
<pre><code class="lang-csharp"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">async</span> Task&lt;CurrentUser&gt; <span class="hljs-title">SetAvatar</span> <span class="hljs-params">(<span class="hljs-keyword">byte</span>[] imageBytes)</span>
</span>{
    <span class="hljs-keyword">var</span> headerBoundary = <span class="hljs-string">&quot;--&quot;</span> + Guid.NewGuid().ToString();
    <span class="hljs-keyword">var</span> boundary = <span class="hljs-string">&quot;--&quot;</span> + headerBoundary;
    <span class="hljs-keyword">var</span> sb = <span class="hljs-keyword">new</span> StringBuilder ();

    sb.Append(boundary + <span class="hljs-string">&quot;\r\n&quot;</span>);
    sb.AppendFormat (<span class="hljs-string">&quot;Content-Disposition: attachment; name=\&quot;{0}\&quot;; filename=\&quot;{1}\&quot;\r\n&quot;</span>, <span class="hljs-string">&quot;file&quot;</span>, <span class="hljs-string">&quot;avatar.jpg&quot;</span>);
    sb.Append (<span class="hljs-string">&quot;Content-Type: image/jpeg\r\n&quot;</span>);
    sb.Append (<span class="hljs-string">&quot;Content-Transfer-Encoding: base64\r\n\r\n&quot;</span>);
    sb.Append (Convert.ToBase64String (imageBytes, <span class="hljs-number">0</span>, imageBytes.Length) + <span class="hljs-string">&quot;\r\n&quot;</span>);
    sb.AppendLine (boundary + <span class="hljs-string">&quot;--\r\n&quot;</span>);

    <span class="hljs-keyword">var</span> postBody = <span class="hljs-keyword">new</span> StringContent (sb.ToString());
    postBody.Headers.Remove (<span class="hljs-string">&quot;Content-Type&quot;</span>);
    postBody.Headers.TryAddWithoutValidation (<span class="hljs-string">&quot;Content-Type&quot;</span>, <span class="hljs-string">&quot;multipart/form-data; boundary=&quot;</span> + headerBoundary);

    UpdateFromUser(<span class="hljs-keyword">await</span> Request.GetInstance ().Post&lt;User, StringContent&gt; (<span class="hljs-string">&quot;/user/avatar&quot;</span>, postBody));

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
}
</code></pre>
<p>Note the double quotes for the name and filename values. If you are receiving the data with the multiparty npm, then
currently this is needed. This will probably get fixed with <a href="https://github.com/andrewrk/node-multiparty/issues/101" target="_blank">issue 101</a>.</p>
<pre><code>name=\&quot;{0}\&quot;;
</code></pre>
                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../../general/devops/deployment/index.html" class="navigation navigation-prev " aria-label="Previous page: Deployment"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../../general/profiling/index.html" class="navigation navigation-next " aria-label="Next page: Profiling"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../../gitbook/app.js"></script>

    
    <script src="../../gitbook/plugins/gitbook-plugin-jsfiddle/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"jsfiddle":{"tabs":["result","js","css","html"],"height":500,"widht":500}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
